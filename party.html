<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>party!</title>
  <script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>

  <style>
    .item {
      position: absolute;
    }
  </style>

</head>
<body>
  <h1>www.atwater.yoga/party</h1>

  <script>
  var socket = io('/');

  // socket.emit('open', {});

  // socket.on('els', function(els){
  //   els.forEach(function(el, i){
  //     console.log(i);
  //     document.body.innerHTML += el;
  //   });
  // });

  function initEls(){
    var els = new XMLHttpRequest();
    els.onreadystatechange = function() {
      if( els.readyState == XMLHttpRequest.DONE ) {
        if( els.status == 200 ){
          var arr = JSON.parse(els.responseText);
          arr.forEach(function(el, i){
            document.body.innerHTML += el;
          });
        }
        else {
          console.log('error', els.status);
        }
      }
    }

    els.open('GET', '/els', true);
    els.send();
  }

  initEls();

  socket.on('push', function(data){
    console.log('pushed');
    pasteEl(data.html);
  });

  function pasteEl(html){
    document.body.innerHTML += html;
  }

  // function conjureEl(data){
  //   switch( data.type ){
  //     case 'img':
  //       document.body.appendChild(alchemy('img', data.src));
  //       break;
  //     case 'text':
  //       document.body.appendChild(alchemy('p', data.src));
  //       break;
  //   }
  // }

  // function alchemy(type, src){
  //   var el = document.createElement(type);
  //   switch( type ){
  //     case 'img':
  //       el.src = src;
  //       break;
  //     case 'p':
  //       el.textContent = src;
  //   }
  //   el.className = 'item';
  //   el.src = src;
  //   el.style.maxWidth = '50%';
  //   el.style.maxHeight = '50%';
  //   el.style.top = Math.random() * 50 + '%';
  //   el.style.left = Math.random() * 50 + '%';

  //   console.log({html: el.outerHTML})
  //   socket.emit('el', {html : el.outerHTML});
  //   return el;
  // }
  </script>
</body>
</html>
