<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>party!</title>
  <script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>

  <style>
    .item {
      position: absolute;
    }
  </style>

</head>
<body>
  <h1>www.atwater.yoga/party</h1>

  <script>
  var socket = io('/');

  socket.on('els', function(els){
    els.forEach(function(el, i){
      console.log(i);
      document.body.innerHTML += el;
    });
  });

  socket.on('push', function(){
    console.log('pushed');
  })

  socket.on('push', function(data){
    conjureEl(data);
  });

  function conjureEl(data){
    switch( data.type ){
      case 'img':
        document.body.appendChild(alchemy('img', data.src));
        break;
      case 'text':
        document.body.appendChild(alchemy('p', data.src));
        break;
    }
  }

  function alchemy(type, src){
    var el = document.createElement(type);
    switch( type ){
      case 'img':
        el.src = src;
        break;
      case 'p':
        el.textContent = src;
    }
    el.className = 'item';
    el.src = src;
    el.style.maxWidth = '50%';
    el.style.maxHeight = '50%';
    el.style.top = el.style.left =
      Math.random() * 50 + '%';

    console.log({html: el.outerHTML})
    socket.emit('el', {html : el.outerHTML});
    return el;
  }
  </script>
</body>
</html>
