<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>party!</title>
  <script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>

  <style>
    html, body {
      margin: 0;
      height: 100%;
    }
    main {
      height: 100%;
    }
    .item {
      position: absolute;
      opacity: 0;
      animation: glow-up 0.5s ease forwards;
    }
    .item.glow-out {
      animation: glow-out 0.5s ease forwards;
    }
    @keyframes glow-up {
      0% {
        opacity: 0;
        transform: translate(0%, 10%);
      }
      100% {
        opacity: 1;
        transform: translate(0%, 0%);
      }
    }
    @keyframes glow-out {
      0% {
        opacity: 1;
        transform: translate(0%, 0%);
      }
      100% {
        opacity: 0;
        transform: translate(0%, -10%);
      }
    }
  </style>

</head>
<body>
  <main id="main"></main>
  <h1 style="position:absolute;bottom:0;right:0;">www.atwater.yoga/party</h1>
  <script>
  var socket = io('/'),
      main = document.getElementById('main');

  function initEls(){
    var els = new XMLHttpRequest();
    els.onreadystatechange = function() {
      if( els.readyState == XMLHttpRequest.DONE ) {
        if( els.status == 200 ){
          var arr = JSON.parse(els.responseText);
          arr.forEach(function(el, i){
            pasteEl(el);
          });
        }
        else {
          console.log('error', els.status);
        }
      }
    }

    els.open('GET', '/els', true);
    els.send();
  }

  initEls();

  socket.on('push', function(data){
    console.log('pushed');
    pasteEl(data.html);
  });

  function pasteEl(html){
    var node = document.createElement('span');
    main.appendChild(node);
    node.outerHTML = html;

    if( main.childNodes.length > 50 ){
      main.childNodes[0].className += ' glow-out';
      setTimeout(function(){
        main.removeChild(main.childNodes[0]);
        socket.emit('pop', {el : main.childNodes[0]});
      }, 500);
    }
  }

  </script>
</body>
</html>
